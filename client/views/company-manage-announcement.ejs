<head>
  <link href="/css/general.css" rel="stylesheet" />
  <link href="/css/company-create-announcement.css" rel="stylesheet" />
</head>

<div class="container-ad">
  <h2 class="text-center my-4">Gerir An√∫ncio</h2>
  <form id="editAnuncioForm" method="POST" action="/company-manage-announcement?id=<%= announcement._id %>">
    <label
      >Nome da profiss√£o
      <input type="text" name="job_name" id="job_name" value="<%=announcement.job_name%>"/>
    </label>
    <label
      >Categoria
      <select name="category" id="category">
        <option>-- Selecione uma op√ß√£o --</option>
        <option value="Restaura√ß√£o" <%= announcement.category === 'Restaura√ß√£o' ? 'selected' : '' %>>Restaura√ß√£o</option>
        <option value="Limpeza" <%= announcement.category === 'Limpeza' ? 'selected' : '' %>>Limpeza</option>
        <option value="Constru√ß√£o" <%= announcement.category === 'Constru√ß√£o' ? 'selected' : '' %>>Constru√ß√£o</option>
        <option value="Vendedor" <%= announcement.category === 'Vendedor' ? 'selected' : '' %>>Vendedor</option>
        <option value="Sa√∫de" <%= announcement.category === 'Sa√∫de' ? 'selected' : '' %>>Sa√∫de</option>
        <option value="Educa√ß√£o" <%= announcement.category === 'Educa√ß√£o' ? 'selected' : '' %>>Educa√ß√£o</option>
        <option value="IT" <%= announcement.category === 'IT' ? 'selected' : '' %>>IT</option>
        <option value="Administra√ß√£o" <%= announcement.category === 'Administra√ß√£o' ? 'selected' : '' %>>Administra√ß√£o</option>
        <option value="Transporte" <%= announcement.category === 'Transporte' ? 'selected' : '' %>>Transporte</option>
        <option value="Atendimento ao Cliente" <%= announcement.category === 'Atendimento ao Cliente' ? 'selected' : '' %>>Atendimento ao Cliente</option>
        <option value="Marketing" <%= announcement.category === 'Marketing' ? 'selected' : '' %>>Marketing</option>
        <option value="Financeiro" <%=announcement.category==='Financeiro' ? 'selected' : '' %>>Financeiro</option>
        <option value="Log√≠stica" <%=announcement.category==='Log√≠stica' ? 'selected' : '' %>>Log√≠stica</option>
        <option value="Seguran√ßa" <%=announcement.category==='Seguran√ßa' ? 'selected' : '' %>>Seguran√ßa</option>
        <option value="Servi√ßos Gerais" <%=announcement.category==='Servi√ßos Gerais' ? 'selected' : '' %>>Servi√ßos Gerais
        </option>

      </select>
    </label>
    <label
      >Tipo de contrato
      <select name="type" id="type">
  <option value="">-- Selecione uma op√ß√£o --</option>
  <option value="Emprego" <%= announcement.type === 'Emprego' ? 'selected' : '' %>>Emprego</option>
  <option value="Est√°gio" <%= announcement.type === 'Est√°gio' ? 'selected' : '' %>>Est√°gio</option>
</select>

    </label>
    <label
      >Local do emprego
      <input type="text" name="municipality" id="municipality" value="<%=announcement.municipality%>"/>
    </label>
    <label>
  Regime
  <select name="regime" id="regime">
    <option value="">-- Selecione uma op√ß√£o --</option>
    <option value="Full-Time" <%= announcement.regime === 'Full-Time' ? 'selected' : '' %>>Full-Time</option>
    <option value="Part-Time" <%= announcement.regime === 'Part-Time' ? 'selected' : '' %>>Part-Time</option>
  </select>
</label>

<label>
  Escolaridade
  <select name="education_level" required>
    <option value="">Selecione uma op√ß√£o</option>
    <option value="ensino b√°sico" <%= announcement.education_level === 'ensino b√°sico' ? 'selected' : '' %>>Ensino b√°sico</option>
    <option value="ensino secund√°rio" <%= announcement.education_level === 'ensino secund√°rio' ? 'selected' : '' %>>Ensino secund√°rio</option>
    <option value="ensino superior" <%= announcement.education_level === 'ensino superior' ? 'selected' : '' %>>Ensino superior</option>
  </select>
</label>

<div class="mb-3">
  <label>L√≠nguas</label>
  <div class="d-flex flex-wrap gap-3">
    <div class="form-check">
      <input class="form-check-input" type="checkbox" name="languages[]" value="Eng" id="lingua-ingles"
        <%= announcement.languages && announcement.languages.includes('Eng') ? 'checked' : '' %>>
      <label class="form-check-label" for="lingua-ingles">Ingl√™s</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" name="languages[]" value="Fr" id="lingua-frances"
        <%= announcement.languages && announcement.languages.includes('Fr') ? 'checked' : '' %>>
      <label class="form-check-label" for="lingua-frances">Franc√™s</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" name="languages[]" value="Esp" id="lingua-espanhol"
        <%= announcement.languages && announcement.languages.includes('Esp') ? 'checked' : '' %>>
      <label class="form-check-label" for="lingua-espanhol">Espanhol</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="checkbox" name="languages[]" value="Ger" id="lingua-alemao"
        <%= announcement.languages && announcement.languages.includes('Ger') ? 'checked' : '' %>>
      <label class="form-check-label" for="lingua-alemao">Alem√£o</label>
    </div>
  </div>
  
</div>

    <label
      >Sal√°rio
      <input type="text" name="salary" required value="<%= announcement.salary%>" />
    </label>
      <label>Hor√°rio de trabalho
      <div class="d-inline-flex p-2 gap-5">
    <div class="form-group">
      <label for="inicio">Hor√°rio de In√≠cio:</label>
      <input type="time" id="inicio" name="schedule[startTime]" value="<%= announcement.schedule['startTime']%>">
    </div>

    <div class="form-group">
      <label for="fim">Hor√°rio de T√©rmino:</label>
      <input type="time" id="fim" name="schedule[endTime]" value="<%= announcement.schedule['endTime']%>">
    </div>
</div>
    <label
      >Prazo de candidatura
      <input type="text" name="end_date" value="<%=announcement.end_date%>" required />
    </label>
    <label>
  Descri√ß√£o
  <textarea name="description" id="description"><%= announcement.description %></textarea>
</label>

    <label
      >Alterar foto
      <label>
        <input type="text" name="pic" value="<%= announcement.pic %>" />
      </label>
    </label>
    <div class="actions-btn">
      <button type="button" class="btn btn-blue" onclick="history.back()">
        Voltar
      </button>
      <button type="submit" class="btn btn-blue">Guardar</button>
    </div>
    <div class="actions-btn">
      <button id="deletebtn" type="button" class="btn btn-delete">
        Eliminar üóëÔ∏è
      </button>
    </div>
  </form>
</div>
<div class="modal" id="confirmModal" style="display: none;">
  <span class="close" onclick="closeModal()">&times;</span>
  <div class="icon">!</div>
  <h2>Tem certeza?</h2>
  <p>Voc√™ est√° prestes a excluir seu an√∫ncio. Esta a√ß√£o n√£o pode ser desfeita.</p>
  <div class="buttons">
    <button class="delete-btn" onclick="confirmDelete()">Sim, excluir</button>
    <button class="cancel-btn" onclick="closeModal()">Cancelar</button>
  </div>
</div>

<!-- Script -->
<script>
  // ID do an√∫ncio (passado do EJS para JS)
  const announcementId = "<%= announcement._id %>";

  // Bot√£o "Eliminar"
  document.getElementById("deletebtn").addEventListener("click", () => {
    document.getElementById("confirmModal").style.display = "block";
  });

  // Fecha o modal
  function closeModal() {
    document.getElementById("confirmModal").style.display = "none";
  }
  // Confirma elimina√ß√£o
  async function confirmDelete() {
    try {
      const response = await fetch(`/company-manage-announcement?id=${announcementId}`, {
        method: "DELETE"
      }
      );

      if (response.ok) {
        alert("An√∫ncio eliminado com sucesso!");
        window.location.href = "/company-my-announcements";
      } else {
        const errorText = await response.text();
        alert("Erro ao eliminar an√∫ncio: " + errorText);
      }
    } catch (err) {
      console.error("Erro ao eliminar:", err);
      alert("Erro interno ao tentar eliminar o an√∫ncio.");
    } finally {
      closeModal();
    }
  }
</script>


