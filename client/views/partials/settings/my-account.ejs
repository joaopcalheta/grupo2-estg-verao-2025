<head>
  <link href="/css/general.css" rel="stylesheet" />
  <link href="/css/client-my-profile.css" rel="stylesheet" />
</head>


<form
  id="profile-form"
  method="POST"
  action="/my-account"
  enctype="multipart/form-data"
>
  <input
    type="file"
    id="uploadFoto"
    name="avatar"
    accept="image/*"
    style="display: none"
  />
  <div
    id="pfp-container"
    class="candidate-img"
    style="cursor: pointer; text-align: center"
  >
    <img
      id="pfpImg"
      src="<%= user.avatar || '/images/my-account.png' %>"
      alt="pfp"
    />
    <p id="pfpChange">Alterar Imagem</p>
  </div>

</br>

  <!-- name -->
  <div>
    <label class="mb-1 fw-bolder" for="name">Nome Completo</label>
    <input
class="mb-2"
      type="text"
      name="name"
      placeholder="Nome completo"
      value="<%= user.name %>"
      minlength="2"
      maxlength="100"
      required
    />
  </div>

  <!-- birthdate -->
  <div>
    <label class="mb-1 fw-bolder" for="birthdate">Data de Nascimento</label>
    <input
class="mb-2"
      type="date"
      name="birthdate"
      value="<%= user.birthdate ? user.birthdate.toISOString().substring(0, 10) : '' %>"
      max="<%= new Date().toISOString().substring(0, 10) %>"
 
    
    />
  </div>

  <!-- username -->
  <div>
    <label class="mb-1 fw-bolder" for="username">Nome do Utilizador</label>
    <input
class="mb-2"
      type="text"
      name="username"
      placeholder="Nome de Utilizador"
      value="<%= user.username %>"
      minlength="3"
      maxlength="30"
      pattern="^[a-z0-9_.-]+$"
      title="Apenas letras minúsculas, números, '.', '-' e '_' são permitidos"
      required
    />
  </div>

  <!-- phone -->
  <div>
    <label class="mb-1 fw-bolder" for="phone">Telefone</label>
    <input
class="mb-2"
      type="tel"
      name="phone"
      placeholder="Nº Telemóvel"
      value="<%= user.phone %>"
      pattern="^\+?[0-9]{9,15}$"
      title="Número de telefone inválido. Deve conter 9 a 15 dígitos, opcional '+' no início."
    />
  </div>

  <!-- address -->
  <div>
    <label class="mb-1 fw-bolder" for="address">Morada</label>
    <input
class="mb-2"
      type="text"
      name="address"
      placeholder="Morada"
      value="<%= user.address %>"
      maxlength="200"
    />
  </div>

  <!-- municipality -->
  <div>
    <label class="mb-1 fw-bolder" for="municipality">Concelho</label>
    <select name="municipality" id="municipality">
        <option value="">-- Selecione uma opção --</option>
    <option value="Ponta do Sol" <%= user.municipality === 'Ponta do Sol' ? 'selected' : '' %>>Ponta do Sol</option>
  <option value="Calheta" <%= user.municipality === 'Calheta' ? 'selected' : '' %>>Calheta</option>
<option value="Ribeira Brava" <%= user.municipality === 'Ribeira Brava' ? 'selected' : '' %>>Ribeira Brava</option>
<option value="Câmara de Lobos" <%= user.municipality === 'Câmara de Lobos' ? 'selected' : '' %>>Câmara de Lobos</option>
<option value="Funchal" <%= user.municipality === 'Funchal' ? 'selected' : '' %>>Funchal</option>
<option value="Santa Cruz" <%= user.municipality === 'Santa Cruz' ? 'selected' : '' %>>Santa Cruz</option>
<option value="Machico" <%= user.municipality === 'Machico' ? 'selected' : '' %>>Machico</option>
<option value="Santana" <%= user.municipality === 'Santana' ? 'selected' : '' %>>Santana</option>
<option value="São Vicente" <%= user.municipality === 'São Vicente' ? 'selected' : '' %>>São Vicente</option>
<option value="Porto Moniz" <%= user.municipality === 'Porto Moniz' ? 'selected' : '' %>>Porto Moniz</option>
<option value="Porto Santo" <%= user.municipality === 'Porto Santo' ? 'selected' : '' %>>Porto Santo</option>
</select>

    <!--<input
class="mb-2"
      type="text"
      name="municipality"
      placeholder="Localidade"
      value="<%= user.municipality %>"
      maxlength="100"
    />-->
  </div>

  <!-- postcode -->
  <div>
    <label class="mb-1 fw-bolder" for="postcode">Código Postal</label>
    <input
class="mb-2"
      type="text"
      name="postcode"
      placeholder="Código Postal"
      value="<%= user.postcode %>"
      pattern="^\d{4}-\d{3}$"
      title="Código postal deve estar no formato 1234-567."
    />
  </div>

  <!-- nif -->
  <div>
    <label class="mb-1 fw-bolder" for="nif">NIF</label>
    <input
class="mb-2"
      type="text"
      name="nif"
      placeholder="NIF"
      value="<%= user.nif %>"
      pattern="^\d{9}$"
      title="NIF deve conter exatamente 9 dígitos."
    />
  </div>

  <!-- email -->
  <div>
    <label class="mb-1 fw-bolder" for="email">E-mail</label>
    <input
class="mb-2"
      type="email"
      name="email"
      placeholder="E-mail"
      value="<%= user.email %>"
      maxlength="100"
      required
    />
  </div>

  <!-- confirmEmail -->
  <div>
    <label class="mb-1 fw-bolder" for="confirmEmail">Confirmar E-mail</label>
    <input
class="mb-2"
      type="email"
      name="confirmEmail"
      placeholder="Confirmar E-mail"
      required
    />
  </div>

  <!-- currentPassword -->
  <div>
    <label class="mb-1 fw-bolder" for="currentPassword">Palavra-passe Atual</label>
    <input
class="mb-2"
      type="password"
      name="currentPassword"
      placeholder="Palavra-passe Atual"
    />
  </div>

  <!-- newPassword -->
  <div>
    <label class="mb-1 fw-bolder" for="newPassword">Nova Palavra-passe</label>
    <input
 class="mb-2"
      type="password"
      name="newPassword"
      placeholder="Nova Palavra-passe"
      minlength="6"
    />
  </div>

  <!-- resto do form segue igual -->
  <br />
  <br />
  <div class="actions-btn d-flex">
    <div class="d-flex justify-content-between buttonWidth">
      <button type="submit" class="buttonWidth btn btn-blue">Guardar</button>
    </div>
  </div>
  <br />
</form>

<form id="deleteForm" method="POST" action="/my-account?_method=DELETE">
  <div class="actions-btn d-grid buttonWidth">
    <button id="deletebtn" type="submit" class="btn btn-delete">
      Apagar conta
    </button>
  </div>
</form>

<!--COISAS DO AFONSO-->
<script>
  // upload preview
  document.getElementById("pfp-container").addEventListener("click", () => {
    document.getElementById("uploadFoto").click();
  });
  document.getElementById("uploadFoto").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (ev) {
        document.getElementById("pfpImg").src = ev.target.result;
      };
      reader.readAsDataURL(file);
    }
  });
</script>
